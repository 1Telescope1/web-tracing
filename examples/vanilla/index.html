<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>example-vanilla</title>
  </head>
  <body>
    <script type="module" src="/main.ts"></script>
    <div id="app"></div>

    <div>
      <div>Error 捕捉</div>
      <button id="codeErr" onclick="codeError()">代码错误</button>
      <button id="promiseError" onclick="promiseError()">promiseError</button>
      <button id="consoleErr" onclick="consoleErr()">手动输出错误</button>
    </div>
    <br />

    <div>
      <div>Event 点击事件捕捉</div>
      <div
        style="border: 1px solid green; height: 200px; padding: 10px"
        class="sss xxx 111 vvv"
        data-warden-title="xxx"
        data-warden-bigTitle="bigTitle"
        width="100%"
        id="222"
        sdfasd
      >
        <div
          style="border: 1px solid red; height: 100px; padding: 10px"
          data-warden-test="test"
          data-warden-title="titletitle"
          data-warden-bing="bing"
          data-warden-event-id="ddd"
        >
          <!-- <img src="../../public/face.jpg" alt="" /> -->
          <div style="border: 1px solid rgb(71, 1, 236)">asdasdasd</div>
        </div>
        <div data-warden-id="我是ID">
          <button value="xxxxxx" ref="bun">1111</button>
        </div>
      </div>
    </div>
    <br />

    <div>
      <div>Http 事件捕捉</div>
      <button id="normalReq" onclick="onClickXhrNormal()">xhr正常请求</button>
      <button id="exceptionReq" onclick="onClickXhrError()">xhr异常请求</button>
      <button id="normalFetch" onclick="onClickNativeFetch()">
        Fetch正常请求
      </button>
      <button id="exceptionFetch" onclick="onClickNativeErrorFetch()">
        Fetch异常请求
      </button>
    </div>
    <br />

    <button id="hashChange" onclick="hashChange()">改变hash</button>
    <a href="/vue2/index.html">跳到Vue2页面</a>
    <a href="/vue3/index.html">跳到Vue3页面</a>
    <a href="http://www.baidu.com" target="_blank">跳到百度</a>

    <script>
      // ---------------- Error 捕捉 ----------------
      function codeError() {
        let a = {};
        a.split("/");
      }
      function promiseError() {
        const promiseWrap = () =>
          new Promise((resolve, reject) => {
            reject("promise reject");
          });
        promiseWrap().then((res) => {
          console.log("res", res);
        });
      }
      function consoleErr() {
        console.error("consoleErr1", "consoleErr1.1", "consoleErr1.2");
        console.error("consoleErr2");
        console.error(new Error("谢谢谢谢谢"));
      }

      // ---------------- Http 事件捕捉 ----------------
      function onClickXhrNormal() {
        const xhr = new XMLHttpRequest();
        xhr.open("get", "/normal");
        xhr.setRequestHeader("content-type", "application/json");
        xhr.send();
        xhr.onreadystatechange = function () {
          if (xhr.readyState === 4) {
            console.log('请求成功', xhr.responseText.slice(0, 10));
          }
        };
      }
      function onClickXhrError() {
        const xhr = new XMLHttpRequest();
        xhr.open("get", "/exception");
        xhr.setRequestHeader("content-type", "application/json");
        xhr.send();
        xhr.onreadystatechange = function () {
          if (xhr.readyState === 4) {
            console.log('请求成功', xhr.responseText.slice(0, 10));
          }
        };
      }
      function onClickNativeFetch() {
        fetch("/normal/post", {
          method: "POST",
          body: JSON.stringify({ test: "测试请求体" }),
          mode: "cors",
          headers: {
            "Content-Type": "application/json",
          },
        }).then((res) => {
          res.text().then((res) => console.log("res", res));
        });
      }
      function onClickNativeErrorFetch() {
        fetch("/exception/post", {
          method: "POST",
          body: JSON.stringify({ test: "测试请求体" }),
          mode: "cors",
          headers: {
            "Content-Type": "application/json",
          },
        }).then(
          (res) => {
            res.text().then((res) => console.log("res", res));
          },
          (err) => {
            console.log("err", err);
          }
        );
      }
      function hashChange() {
        window.location.hash = "xxx";
      }
    </script>
  </body>
</html>
